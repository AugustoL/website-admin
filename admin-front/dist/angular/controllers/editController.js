/*
 AugustoLemble 2016-02-12 
*/
angular.module("ALapp.controllers").controller("editController",["$scope","$routeParams","$location","userService","sessionService","$sce",function(a,b,c,d,e,f){console.log("editController init"),a.previewLang=navigator.language||navigator.userLanguage,"es"!=a.previewLang&&(a.previewLang="en"),a.words=e.getStrings(),a.postDate=new Date,a.postCategories=[],a.postTitleEs="",a.postTitleEn="",a.postImage="",a.postBodyEs="",a.postBodyEn="",a.imgSize="s",a.$watch("previewLang",function(b,c){"en"==a.previewLang?($(".shortBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),a.words=e.getStrings("en")):($(".shortBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />")),a.words=e.getStrings("es"))}),d.getCategories().then(function(c){for(var e=0;e<c.data.length;e++)a.postCategories.push({name:c.data[e].nameEn,selected:!1});b.id&&d.getPost(b.id).then(function(b){a.postDate=b.data.post.date;for(var c=0;c<a.postCategories.length;c++)for(var d=0;d<b.data.post.categories.length;d++)b.data.post.categories[d]==a.postCategories[c].name&&(a.postCategories[c].selected=!0);a.postTitleEs=b.data.post.titleEs,a.postTitleEn=b.data.post.titleEn,a.postImage=b.data.post.img,a.postBodyEs=b.data.post.bodyEs.replace(/<br\s*\/?>/gm,"\n"),a.postBodyEn=b.data.post.bodyEn.replace(/<br\s*\/?>/gm,"\n"),$(".shortBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />"))})}),a.triggerPreview=function(a){"short"==a?$("#shortPreview").is(":visible")?$("#shortPreview").hide():$("#shortPreview").show():(a="long")&&($("#longPreview").is(":visible")?$("#longPreview").hide():$("#longPreview").show())},$("#editButton").on("click",function(){for(var e=[],f=0;f<a.postCategories.length;f++)a.postCategories[f].selected&&e.push(a.postCategories[f].name);d.editPost(a.postTitleEs,a.postTitleEn,a.postImage,e,a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />"),a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />"),b.id).then(function(a){a.data.success&&c.path("/admin")})}),a.updateBody=function(){"es"==a.previewLang?($(".shortBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />"))):($(".shortBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")))},a.addImg=function(b){if(("s"==a.imgSize||"m"==a.imgSize||"l"==a.imgSize||"xl"==a.imgSize)&&a.imgName.length>0){var c=document.getElementById("bodyInput"+b).selectionStart,d=jQuery("#bodyInput"+b).val(),e="<div class='img img-"+a.imgSize+"'><img src='/getImage?name="+a.imgName+"'></div>";a["postBody"+b]=d.substring(0,c)+e+d.substring(c),$("#bodyInput"+b).val(d.substring(0,c)+e+d.substring(c))}},a.addVideo=function(b){if(a.videoCode.length>0){var c=document.getElementById("bodyInput"+b).selectionStart,d=jQuery("#bodyInput"+b).val(),e="<legend><h4 class='text-center'>"+a.videoName+"</h4></legend><div class='row text-center'><iframe width='420' height='315' src='https://www.youtube.com/embed/"+a.videoCode+"'></iframe></div>";a["postBody"+b]=d.substring(0,c)+e+d.substring(c),$("#bodyInput"+b).val(d.substring(0,c)+e+d.substring(c))}},a.toTrusted=function(a){return f.trustAsHtml(a)}}]);