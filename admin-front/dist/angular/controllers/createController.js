/*
 AugustoLemble 2016-02-12 
*/
angular.module("ALapp.controllers").controller("createController",["$scope","$routeParams","$location","userService","sessionService",function(a,b,c,d,e){console.log("createController init"),a.words=e.getStrings(),a.previewLang=a.language,a.postDate=new Date,a.postCategories=[],a.postTitleEs="",a.postTitleEn="",a.postImage="",a.postBodyEs="",a.postBodyEn="",a.imgSize="s",d.getCategories().then(function(b){for(var c=0;c<b.data.length;c++)a.postCategories.push({name:b.data[c].nameEn,selected:!1})}),a.$watch("previewLang",function(b,c){"en"==a.previewLang?($(".shortBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),a.words=e.getStrings("en")):($(".shortBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />")),a.words=e.getStrings("es"))}),a.triggerPreview=function(a){"short"==a?$("#shortPreview").is(":visible")?$("#shortPreview").hide():$("#shortPreview").show():(a="long")&&($("#longPreview").is(":visible")?$("#longPreview").hide():$("#longPreview").show())},$("#editButton").on("click",function(){for(var b=[],e=0;e<a.postCategories.length;e++)a.postCategories[e].selected&&b.push(a.postCategories[e].name);d.createPost(a.postTitleEs,a.postTitleEn,a.postImage,b,a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />"),a.postBodyEn.replace(/(?:\r\n|\r|\n)/g,"<br />")).then(function(a){a.data.success&&c.path("/admin")})}),a.updateBody=function(){"es"==a.previewLang?($(".shortBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postBodyEs.replace(/(?:\r\n|\r|\n)/g,"<br />"))):($(".shortBody").html(a.postTitleEn.replace(/(?:\r\n|\r|\n)/g,"<br />")),$(".longBody").html(a.postTitleEn.replace(/(?:\r\n|\r|\n)/g,"<br />")))},a.addImg=function(b){if(("s"==a.imgSize||"m"==a.imgSize||"l"==a.imgSize||"xl"==a.imgSize)&&a.imgName.length>0){var c=document.getElementById("bodyInput"+b).selectionStart,d=jQuery("#bodyInput"+b).val(),e="<div class='img img-"+a.imgSize+"'><img src='/getImage?name="+a.imgName+"'></div>";a["postBody"+b]=d.substring(0,c)+e+d.substring(c),$("#bodyInput"+b).val(d.substring(0,c)+e+d.substring(c))}},a.addVideo=function(b){if(a.videoCode.length>0){var c=document.getElementById("bodyInput"+b).selectionStart,d=jQuery("#bodyInput"+b).val(),e="<legend><h4>"+a.videoName+"</h4></legend><div class='row text-center'><iframe width='420' height='315' src='https://www.youtube.com/embed/"+a.videoCode+"'></iframe></div>";a["postBody"+b]=d.substring(0,c)+e+d.substring(c),$("#bodyInput"+b).val(d.substring(0,c)+e+d.substring(c))}},a.toTrusted=function(a){return $sce.trustAsHtml(a)}}]);